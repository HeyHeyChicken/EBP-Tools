<!--
Copyright (c) 2025, Antoine Duval
This file is part of a source-visible project.
See LICENSE for terms. Unauthorized use is prohibited.
-->

<mat-dialog-content #matDialogContent>
  <button
    class="squared"
    mat-dialog-close
    matTooltip="{{ 'common.close' | translate }}"
    [class.invisible]="loading"
  >
    <i class="fa-sharp fa-solid fa-xmark"></i>
  </button>
  <div class="d-flex" [class.invisible]="loading">
    <video
      #videoPlayer
      autoplay
      [muted]="true"
      (timeupdate)="onTimeUpdate(videoPlayer)"
      (loadedmetadata)="onLoadedMetadata(videoPlayer)"
      (loadeddata)="resizeVideo()"
      [src]="
          'http://localhost:' +
          globalService.serverPort +
          '/file?path=' +
          data
        "
    ></video>
    <footer>
      <button
        class="squared"
        (click)="addVideoTime(videoPlayer, -1)"
        matTooltipPosition="above"
        matTooltip="{{ 'view.replay_cutter.dialog.manual-video-cut.removeTime' | translate }}"
      >
        <i class="fa-sharp fa-solid fa-backward"></i>
      </button>
      <button
        class="squared"
        (click)="playPause(videoPlayer)"
        matTooltipPosition="above"
        matTooltip="{{ 'view.replay_cutter.dialog.manual-video-cut.' + (playing ? 'pause' : 'play' )| translate }}"
      >
        <i
          class="fa-sharp fa-solid"
          [class.fa-pause]="playing"
          [class.fa-play]="!playing"
        ></i>
      </button>
      <button
        class="squared"
        (click)="addVideoTime(videoPlayer, +1)"
        matTooltipPosition="above"
        matTooltip="{{ 'view.replay_cutter.dialog.manual-video-cut.addTime' | translate }}"
      >
        <i class="fa-sharp fa-solid fa-forward"></i>
      </button>
      <hr />
      <button
        class="squared"
        (click)="cut()"
        matTooltipPosition="above"
        matTooltip="{{ 'view.replay_cutter.dialog.manual-video-cut.cut' | translate }}"
      >
        <i class="fa-sharp fa-solid fa-scissors"></i>
      </button>
      <div #videoBar class="bar" (mousedown)="mouseDownOnBar($event)">
        <div class="chunks">
          @for(chunk of chunks; track $index){
          <div
            class="chunk"
            [class.removed]="chunk.remove"
            [style.left]="(chunk.start / videoDuration * 100) + '%'"
            [style.width]="((chunk.end - chunk.start) / videoDuration * 100) + '%'"
          >
            <button
              *ngIf="chunks.length > 1"
              class="squared"
              [class.green]="chunk.remove"
              [class.red]="!chunk.remove"
              (mousedown)="removeChunk(chunk, $event)"
            >
              <i
                class="fa-sharp fa-solid"
                [class.fa-arrow-up]="chunk.remove"
                [class.fa-trash]="!chunk.remove"
              ></i>
            </button>
          </div>
          }
        </div>
        <div
          class="cursor"
          [style.left]="(videoCurrentTime / (videoDuration + 12)) * 100 + '%'"
        >
          <div><div></div></div>
        </div>
      </div>
      <button
        class="squared green"
        [class.disabled]="submitButtonIsDisabled"
        matTooltipPosition="above"
        matTooltip="{{ 'common.save' | translate }}"
        (click)="submit()"
      >
        <i class="fa-sharp fa-solid fa-floppy-disk"></i>
      </button>
      <ebp-assistant
        textWidth="500px"
        (change)="onAssistantStateChange($event)"
        text="{{ 'view.replay_cutter.dialog.manual-video-cut.explanations' | translate}}"
      ></ebp-assistant>
    </footer>
  </div>
  @if(loading){
  <mat-spinner></mat-spinner>
  }
</mat-dialog-content>
