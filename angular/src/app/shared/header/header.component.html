<!--
Copyright (c) 2025, Antoine Duval
This file is part of a source-visible project.
See LICENSE for terms. Unauthorized use is prohibited.
-->
<!-- #region LEFT -->
<a class="logo" (click)="openURLExternalBrowser(globalService.webSiteURL)">
  <img
    height="24px"
    alt="EBP's logo"
    src="/assets/img/logo.svg"
    matTooltip="{{ 'shared.header.accessWebsite' | translate }}"
  />
  @if (identityService.isBetaUser) {
    <span class="beta" (click)="$event.stopPropagation()">beta</span>
  }
</a>
<a
  class="btn squared"
  routerLink="/{{ translateService.currentLang }}"
  (click)="page = undefined"
  matTooltip="{{ 'shared.header.home' | translate }}"
>
  <i class="fa-sharp fa-solid fa-house"></i>
</a>
<mat-form-field matTooltip="{{ 'shared.header.changeTool' | translate }}">
  <mat-select [(ngModel)]="page" (selectionChange)="changeTool($event)">
    @for (page of pages; track page) {
      <mat-option [value]="page">
        {{ 'shared.header.tools.' + page | translate }}
      </mat-option>
    }
  </mat-select>
</mat-form-field>
<!-- #endregion -->
<!-- #region RIGHT -->
<div class="right">
  @if (identityService.isBetaUser) {
    <div>
      <div
        class="coins"
        (click)="headerService.showCoinsPopup = !headerService.showCoinsPopup"
      >
        <ebp-coin></ebp-coin>
        {{ identityService.coins ?? '...' }}
        @if (headerService.showCoinsPopup) {
          <div class="shadow"></div>
          <div class="popup">
            <button (click)="getMoreCoins()">
              {{ 'shared.header.getMoreCoins' | translate }}
            </button>
          </div>
        }
      </div>
    </div>
  }
  <div class="language_selector">
    <img
      alt="Language flag"
      src="/assets/img/flags/{{ translateService.currentLang }}.webp"
    />
    <select
      aria-label="Language selector"
      (change)="languageSelectChanged($event)"
    >
      @for (lang of translateService.langs; track lang) {
        <option
          value="{{ lang }}"
          [selected]="lang == translateService.currentLang"
        >
          {{ lang }}
        </option>
      }
    </select>
  </div>
  <div>
    <a
      class="btn squared discord"
      aria-label="Discord"
      (click)="openURLExternalBrowser(globalService.discordServerURL)"
      matTooltip="{{ 'shared.header.accessDiscordServer' | translate }}"
    >
      <i class="fa-brands fa-discord"></i>
    </a>
  </div>
  <div>
    <a
      class="btn squared"
      (click)="showMyAccountBox = true"
      [class.disabled]="disableLogoutButton"
    >
      <i class="fa-sharp fa-solid fa-user"></i>
    </a>

    @if (showMyAccountBox) {
      <div class="shadow" (click)="showMyAccountBox = false"></div>
      <div class="box">
        <button class="btn w-100 red" (click)="logout()">
          {{ 'shared.header.logout' | translate }}
        </button>
        <mat-form-field class="mt-2">
          <mat-label>{{ 'shared.header.chooseATeam' | translate }}</mat-label>
          <mat-select
            [(ngModel)]="identityService.selectedTeamsIndex"
            (selectionChange)="showMyAccountBox = false"
            [disabled]="identityService.teams.length == 1"
          >
            <mat-select-trigger>
              {{
                this.identityService.teams[
                  this.identityService.selectedTeamsIndex
                ].name
              }}
            </mat-select-trigger>
            <mat-option
              *ngFor="let team of identityService.teams; index as i"
              [value]="i"
            >
              {{ team.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    }
  </div>
</div>
<!-- #endregion -->
